import json
import random
import copy
import geojson


# Define the base structure
base_metadata = {
    "id": "0",
    "type": "Feature",
    "properties": {
        "Fold": 1,
        "ID_PATCH": 0,
        "TILE": "t30uxv",
        "dates-S2": {
                   "0": 20180924,
                    "1": 20180929,
                    "2": 20181004,
                    "3": 20181009,
                    "4": 20181019,
                    "5": 20181024,
                    "6": 20181029,
                    "7": 20181108,
                    "8": 20181113,
                    "9": 20181118,
                    "10": 20181123,
                    "11": 20190117,
                    "12": 20190122,
                    "13": 20190216,
                    "14": 20190221,
                    "15": 20190226,
                    "16": 20190313,
                    "17": 20190328,
                    "18": 20190412,
                    "19": 20190422,
                    "20": 20190427,
                    "21": 20190512,
                    "22": 20190527,
                    "23": 20190601,
                    "24": 20190606,
                    "25": 20190621,
                    "26": 20190626,
                    "27": 20190701,
                    "28": 20190706,
                    "29": 20190711,
                    "30": 20190716,
                    "31": 20190731,
                    "32": 20190810,
                    "33": 20190815,
                    "34": 20190820,
                    "35": 20190825,
                    "36": 20190830,
                    "37": 20190904,
                    "38": 20190914,
                    "39": 20190919,
                    "40": 20190924,
                    "41": 20191009,
                    "42": 20191019
        },
        "id": "0"
    },
    "geometry": {
        "type": "MultiPolygon",
        "coordinates":[
                    [
                        [
                            [
                                391504.7355450863,
                                6956805.915242429
                            ],
                            [
                                392781.90612797183,
                                6956707.2616562415
                            ],
                            [
                                392683.2488295328,
                                6955430.101275591
                            ],
                            [
                                391406.092152948,
                                6955528.748381898
                            ],
                            [
                                391504.7355450863,
                                6956805.915242429
                            ]
                        ]
                    ]
                ]
    }
}

# coordinates_data = [

#     { "type": "Feature", "properties": { "parcel_id": "0" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.07049560546875, 45.012466430664062 ], [ 5.07049560546875, 45.023876190185547 ], [ 5.081904411315918, 45.023876190185547 ], [ 5.081904411315918, 45.012466430664062 ], [ 5.07049560546875, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "1" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.08199405670166, 45.012466430664062 ], [ 5.08199405670166, 45.023876190185547 ], [ 5.093402862548828, 45.023876190185547 ], [ 5.093402862548828, 45.012466430664062 ], [ 5.08199405670166, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "2" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.09349250793457, 45.012466430664062 ], [ 5.09349250793457, 45.023876190185547 ], [ 5.104901313781738, 45.023876190185547 ], [ 5.104901313781738, 45.012466430664062 ], [ 5.09349250793457, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "3" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.10499095916748, 45.012466430664062 ], [ 5.10499095916748, 45.023876190185547 ], [ 5.116399765014648, 45.023876190185547 ], [ 5.116399765014648, 45.012466430664062 ], [ 5.10499095916748, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "4" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.116489410400391, 45.012466430664062 ], [ 5.116489410400391, 45.023876190185547 ], [ 5.127898216247559, 45.023876190185547 ], [ 5.127898216247559, 45.012466430664062 ], [ 5.116489410400391, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "5" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.127987861633301, 45.012466430664062 ], [ 5.127987861633301, 45.023876190185547 ], [ 5.139396667480469, 45.023876190185547 ], [ 5.139396667480469, 45.012466430664062 ], [ 5.127987861633301, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "6" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.139486312866211, 45.012466430664062 ], [ 5.139486312866211, 45.023876190185547 ], [ 5.150895118713379, 45.023876190185547 ], [ 5.150895118713379, 45.012466430664062 ], [ 5.139486312866211, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "7" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.150984764099121, 45.012466430664062 ], [ 5.150984764099121, 45.023876190185547 ], [ 5.162393569946289, 45.023876190185547 ], [ 5.162393569946289, 45.012466430664062 ], [ 5.150984764099121, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "8" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.162483215332031, 45.012466430664062 ], [ 5.162483215332031, 45.023876190185547 ], [ 5.173892021179199, 45.023876190185547 ], [ 5.173892021179199, 45.012466430664062 ], [ 5.162483215332031, 45.012466430664062 ] ] ] } },
# { "type": "Feature", "properties": { "parcel_id": "9" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 5.173981666564941, 45.012466430664062 ], [ 5.173981666564941, 45.023876190185547 ], [ 5.185389995574951, 45.023876190185547 ], [ 5.185389995574951, 45.012466430664062 ], [ 5.173981666564941, 45.012466430664062 ] ] ] } },
# ]

# Read the GeoJSON file
with open("france/images/parcel_data.geojson", "r") as file:
    data = json.load(file)

coordinates_data = data["features"]
    
# Create 60 instances
metadata_instances = []
for index in range(len(coordinates_data)):
    metadata = copy.deepcopy(base_metadata)
    id_val = coordinates_data[index]["properties"]["parcel_id"]
    metadata["id"] = id_val
    metadata["properties"]["ID_PATCH"] = int(id_val)
    metadata["properties"]["id"] =id_val
    metadata["properties"]["Fold"] = random.randint(1, 5)
    metadata["geometry"]["coordinates"] = coordinates_data[index]["geometry"]["coordinates"]
    metadata_instances.append(metadata)

# Create a FeatureCollection to hold all the metadata instances
feature_collection = geojson.FeatureCollection(metadata_instances)

# Save the feature collection to a GeoJSON file
with open("metadata.geojson", "w") as file:
    geojson.dump(feature_collection, file, indent=4)